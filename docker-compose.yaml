services:
  fetcher:
    build:
      context: .
      target: fetcher
    volumes:
      - ./email-archive/src:/app/email-archive/src
      - ./gmex-sdk/src:/app/gmex-sdk/src
      - ./gmex-cli/src:/app/gmex-cli/src
      - ${DATA_DIR}:/data
      - ${TOKEN_FILE}:/app/creds.json:ro
    environment:
      - EMAIL_ARCHIVE_DATA_DIR=/data
      - GOOGLE_APPLICATION_CREDENTIALS=/app/creds.json
      - GMEX_QUERY=${GMEX_QUERY:-newer_than:1d}
      - GMEX_LIMIT=${GMEX_LIMIT:-5}
    command: ["gmex", "sync"]
